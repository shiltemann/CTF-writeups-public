---
layout: writeup
title: H4sh3D
level: 
difficulty: 
points: 
categories: []
tags: []
flag: 
---
**Challenge**  
We discovered that Varsos's server uses a fairly insecure hash function
to check passwords. The hashed password is c9b5af9864efa933, and the
hashing function can be found here.

    def compute_hash(uinput):
    	if len(uinput) > 32: return
    	blen = 32
    	n = blen - len(uinput) % blen
    	if n == 0:
    		n = blen
    	pad = chr(n)
    	ninput = uinput + pad * n
    	r = ""
    	for i in range(0, blen, 4):
    		s = ninput[i:i+4]
    		h = 0
    		for j in range(len(s)):
    			h = (h << 4) + ord(s[j])
    			g = h & 4026531840
    			if not(g == 0):
    				h ^= g >> 24
    			h &= ~g
    		r += chr(h % 256)
    	h = ""
    	for c in r:
    		h += c.encode("hex")
    	return h
{: .language-python}

## Solution

It is not trivial to reverse the problem, but we see that each group of
four characters is processed independently to give two hex character in
the final hash, so we simply try four-letter strings until we find all
parts of the final hash

    import itertools
    def compute_hash(uinput):
    	if len(uinput) > 32: return
    	blen = 32
    	n = blen - len(uinput) % blen
    	if n == 0:
    		n = blen
    	pad = chr(n)
    	ninput = uinput + pad * n
    	r = ""
    	for i in range(0, blen, 4):
    		s = ninput[i:i+4]
    		h = 0
    		for j in range(len(s)):
    			h = (h << 4) + ord(s[j])
    			g = h & 4026531840
    			if not(g == 0):
    				h ^= g >> 24
    			h &= ~g
    		r += chr(h % 256)
    	h = ""
    	for c in r:
    		h += c.encode("hex")
    	return h
    
    alphabet=list("abcdefghijklmnopqrstuvwxyz")
    perms = list(itertools.permutations(alphabet, 4))
    
    target=["c9","b5","af","98","64","ef","a9","33"]
    target2=target
    solution=["","","","","","","",""]
    
    for p in perms:
        pt=''.join(p)
        ct=compute_hash(pt)
        for t in target:
           if ct[0:2] == t:
               print "Found part! input "+pt+" gives hash chars "+t
               solution[ target2.index(t) ] = pt
               target.remove(t)
        if target == []:
            break
    
    print "Solution: "+''.join(solution)
{: .language-python}

Running this gives output:

    Found part! input abch gives hash chars 98
    Found part! input abcy gives hash chars a9
    Found part! input abdo gives hash chars af
    Found part! input abdu gives hash chars b5
    Found part! input abey gives hash chars c9
    Found part! input abho gives hash chars ef
    Found part! input abls gives hash chars 33
    Found part! input abot gives hash chars 64
    Solution: abotablsabdoabchabcy

